{% extends "base.html" %}

{% block title %} About the project {% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Navigation -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="sidebar-sticky">
                    <h5 class="sidebar-heading">Contents</h5>
                    <nav class="nav flex-column">
                        <a class="nav-link" href="#overview">Overview</a>
                        <a class="nav-link" href="#methodology">Scientific Methodology</a>
                        <nav class="nav flex-column ml-3">
                            <a class="nav-link nav-link-sub" href="#hydraulic-validation">Hydraulic Model Validation</a>
                            <a class="nav-link nav-link-sub" href="#neural-networks">Neural Network Classification</a>
                            <a class="nav-link nav-link-sub" href="#recommendation-system">Recommendation System</a>
                            <a class="nav-link nav-link-sub" href="#data-integration">Data Integration</a>
                            <a class="nav-link nav-link-sub" href="#technical-framework">Technical Framework</a>
                        </nav>
                        <a class="nav-link" href="#applications">Applications & Standards</a>
                        <a class="nav-link" href="#future-development">Future Development</a>
                        <a class="nav-link" href="#contact">Contact & Collaboration</a>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <h2 class="page-title">About Stormwater Analysis System</h2>
                <h3 id="overview">Overview</h3>
                <p>This advanced stormwater analysis system integrates hydraulic modeling with machine learning to provide comprehensive storm sewer network design and optimization. The system processes SWMM (Storm Water Management Model) files through a sophisticated pipeline that validates hydraulic parameters, classifies catchments using neural networks, and generates engineering recommendations based on Polish technical standards and local climatological conditions.</p>

                <h3 id="methodology">Scientific Methodology</h3>

                <h4 id="hydraulic-validation">1. Hydraulic Model Validation and Feature Engineering</h4>
                <p>The methodology begins with comprehensive validation of hydraulic models focused on gravity sewer systems. This iterative process examines model elements and verifies their compliance with implemented assumptions, forming the foundation for feature engineering.</p>

                <h5>1.1 Basic Storm Sewer Parameters Validation</h5>
                <p>The system enforces strict hydraulic criteria based on established Polish and European standards:</p>
                <ul>
                    <li><strong>Maximum flow velocity:</strong> 5.0 m/s (WPT guidelines from Minister of Municipal Economy, 1965)</li>
                    <li><strong>Minimum flow velocity:</strong> 0.7 m/s (PN-EN 752:2008) - specifically adapted for storm sewers carrying lower suspended solid concentrations compared to domestic sewage</li>
                    <li><strong>Maximum pipe burial depth:</strong> 6 m below ground level (WTP 1964)</li>
                    <li><strong>Minimum ground cover:</strong> Variable based on frost zone classification according to PN-81/B-03020</li>
                </ul>

                <h5>Frost Zone Classification System</h5>
                <p>Poland is divided into four frost zones with specific minimum cover requirements for PVC sewer pipes:</p>
                <div class="table-responsive scrollable-table-container">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Frost Zone</th>
                                <th>Ground Frost Depth (m)</th>
                                <th>Minimum Pipe Cover (m)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>I</td><td>0.8</td><td>1.0</td></tr>
                            <tr><td>II</td><td>1.0</td><td>1.2</td></tr>
                            <tr><td>III</td><td>1.2</td><td>1.4</td></tr>
                            <tr><td>IV</td><td>1.4</td><td>1.6</td></tr>
                        </tbody>
                    </table>
                </div>

                <h5>1.2 Self-Cleaning Slope Determination</h5>
                <p>The system calculates minimum slopes essential for maintaining self-cleaning conditions and preventing sediment accumulation. The methodology is based on minimum shear stress (τ_min = 1.5 Pa) requirements, ensuring hydraulic efficiency and preventing deposition of suspended materials.</p>

                <p>Maximum slope determination prevents excessive flow velocities that could cause internal pipe erosion and turbulent flow damage. The system uses an iterative approach with the Manning formula, employing a controlled reduction strategy to approach the maximum allowable velocity of 5.0 m/s within ±0.01 m/s tolerance.</p>

                <h5>1.3 Pipe Filling Validation</h5>
                <p>Maximum pipe filling validation prevents overflow and ensures optimal hydraulic efficiency. Using the Colebrook-White formula for circular cross-sections, the system determines that full hydraulic capacity (100% efficiency) occurs at 82.7% pipe diameter filling, preventing uncontrolled aeration issues.</p>

                <h5>1.4 Minimum Diameter Requirements</h5>
                <p>The system iteratively calculates minimum required diameters ensuring adequate capacity while maintaining hydraulic conditions. This process identifies pipes that can be optimized through diameter reduction, providing cost savings opportunities while maintaining required performance standards.</p>

                <h4 id="neural-networks">2. Catchment Classification Using Neural Networks</h4>
                <p>The system employs sophisticated machine learning to classify catchments based on physical and hydrological characteristics, enabling precise assessment of different surface types' impact on sewer network performance.</p>

                <h5>2.1 Catchment Categories</h5>
                <p>The classification system recognizes 14 distinct catchment types based on permeability and land cover characteristics:</p>
                <div class="table-responsive scrollable-table-container">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Hydrological Characteristics</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Permeable Areas</td><td>High permeability regions</td><td>Free water infiltration, limited surface runoff</td></tr>
                            <tr><td>Permeable Plains</td><td>Flat/slightly sloped permeable surfaces</td><td>Good infiltration, minimal erosion</td></tr>
                            <tr><td>Vegetated Mountains</td><td>Mountainous areas with vegetation cover</td><td>Water absorption, reduced surface runoff</td></tr>
                            <tr><td>Rocky Mountains</td><td>Mountainous rocky terrain</td><td>High surface runoff, low permeability</td></tr>
                            <tr><td>Low-Density Urban</td><td>Weakly impervious urban areas</td><td>Some infiltration through green spaces</td></tr>
                            <tr><td>Medium-Density Urban</td><td>Moderately impervious urban areas</td><td>Balanced permeable/impermeable surfaces</td></tr>
                            <tr><td>High-Density Urban</td><td>Highly impervious urban areas</td><td>Significant surface runoff, requires stormwater management</td></tr>
                            <tr><td>Low-Density Suburban</td><td>Weakly impervious suburban areas</td><td>High infiltration, large green spaces</td></tr>
                            <tr><td>High-Density Suburban</td><td>Highly impervious suburban areas</td><td>Increased runoff, requires stormwater management</td></tr>
                            <tr><td>Rural Areas</td><td>Moderate permeability rural regions</td><td>Variable hydrological response</td></tr>
                            <tr><td>Forests</td><td>Forested areas</td><td>High permeability, water storage, limited runoff</td></tr>
                            <tr><td>Meadows</td><td>Grassland areas</td><td>Effective infiltration, surface runoff buffer</td></tr>
                            <tr><td>Agricultural Land</td><td>Cultivated areas</td><td>Variable permeability depending on crop type</td></tr>
                            <tr><td>Wetlands</td><td>Low-lying areas with high groundwater</td><td>Natural retention areas, water storage</td></tr>
                        </tbody>
                    </table>
                </div>

                <h5>2.2 Neural Network Architecture & Training</h5>
                <p>The classification model employs a feed-forward neural network with the following specifications:</p>
                <ul>
                    <li><strong>Input Layer:</strong> 12 neurons corresponding to hydrological features with data normalization</li>
                    <li><strong>First Hidden Layer:</strong> 32 neurons with ReLU activation</li>
                    <li><strong>First Dropout Layer:</strong> 0.3 dropout coefficient</li>
                    <li><strong>Second Hidden Layer:</strong> 16 neurons with ReLU activation</li>
                    <li><strong>Second Dropout Layer:</strong> 0.2 dropout coefficient</li>
                    <li><strong>Output Layer:</strong> 14 neurons with softmax activation (corresponding to catchment classes)</li>
                </ul>

                <h5>2.3 Training Data Generation</h5>
                <p>Training data was generated using SWMM models (version 5.2.2) with Horton infiltration method parameters: maximum infiltration rate 75 mm/h, minimum rate 10 mm/h, decay constant 4 hours, drying time 7 hours, and zero infiltration coefficient 0.</p>

                <h5>2.4 Comprehensive Rainfall Scenarios</h5>
                <p>The system incorporates 22 diverse rainfall scenarios to ensure robust model training:</p>

                <h6>Euler Type II Distribution</h6>
                <p>Asymmetric storms with peak intensity at 30% of duration, following German ATV A-118:2006 guidelines adapted for Polish conditions. Implemented for 60, 120, and 240-minute durations with return periods of 3, 10, and 20 years.</p>

                <h6>Chicago Distribution</h6>
                <p>Symmetric storms with peak intensity at 50% duration, representing frontal weather systems. Implemented as 60-minute (95 mm/h) and 120-minute (90 mm/h) variants.</p>

                <h6>Uniform Distribution</h6>
                <p>Constant intensity storms based on Błaszczyk's formula (1954), commonly used in Polish design practice. Applied for 15-minute (50 mm/h) and 30-minute (39 mm/h) durations with 5-year return periods.</p>

                <h6>PANDa Atlas Data</h6>
                <p>Most critical for local accuracy, this data was purchased from IMGW-PIB in June 2025 for Wrocław-Rakowiec location (Rakowiecka 45). Based on 30-year probabilistic rainfall models with specific intensities:</p>
                <div class="table-responsive scrollable-table-container">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Duration (min)</th>
                                <th>10% Probability [mm/h]</th>
                                <th>5% Probability [mm/h]</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>5</td><td>124.18</td><td>144.20</td></tr>
                            <tr><td>10</td><td>93.06</td><td>106.86</td></tr>
                            <tr><td>15</td><td>75.61</td><td>84.74</td></tr>
                            <tr><td>30</td><td>51.31</td><td>58.86</td></tr>
                            <tr><td>60</td><td>37.36</td><td>41.97</td></tr>
                            <tr><td>120</td><td>26.53</td><td>29.59</td></tr>
                            <tr><td>240</td><td>18.84</td><td>20.86</td></tr>
                        </tbody>
                    </table>
                </div>

                <h5>2.5 Model Performance & Validation</h5>
                <p>The final model achieved exceptional performance metrics:</p>
                <ul>
                    <li><strong>Test Accuracy:</strong> 98.28%</li>
                    <li><strong>Training Method:</strong> 3-fold cross-validation with early stopping</li>
                    <li><strong>Optimization:</strong> Grid search across 36 hyperparameter combinations</li>
                    <li><strong>Training Time:</strong> 222 epochs with early stopping tolerance of 20 epochs</li>
                </ul>

                <h5>2.6 Sensitivity Analysis</h5>
                <p>Comprehensive sensitivity analysis using One-At-a-Time (OAT) perturbation method revealed:</p>
                <ul>
                    <li><strong>Most sensitive parameter:</strong> PercImperv (SI = 0.236) - imperviousness percentage</li>
                    <li><strong>Secondary sensitive parameters:</strong> S-Imperv (SI = 0.23), N-Perv (SI = 0.18)</li>
                    <li><strong>Asymmetric response:</strong> Negative perturbations cause stronger reactions than positive ones</li>
                    <li><strong>Stability threshold:</strong> Model maintains classification stability for 85-94% of cases within typical measurement uncertainty (±10-15%)</li>
                </ul>

                <h4 id="recommendation-system">3. Engineering Recommendation System</h4>
                <p>The recommendation module analyzes validated hydraulic parameters and catchment classifications to generate specific engineering solutions through a neural network trained on 5,940 conduit samples.</p>

                <h5>3.1 Recommendation Categories</h5>
                <div class="table-responsive scrollable-table-container">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Class</th>
                                <th>Technical Interpretation</th>
                                <th>Typical Application</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>pump</td><td>Install pumping station</td><td>Pipes below gravitational drainage or near maximum burial depth</td></tr>
                            <tr><td>tank</td><td>Install retention tank</td><td>Peak flow reduction in high imperviousness areas</td></tr>
                            <tr><td>seepage boxes</td><td>Install infiltration boxes</td><td>Pipe relief in permeable soil areas</td></tr>
                            <tr><td>diameter increase</td><td>Increase pipe diameter</td><td>Insufficient capacity indicators</td></tr>
                            <tr><td>diameter reduction</td><td>Reduce pipe diameter</td><td>Oversized pipes below self-cleaning range</td></tr>
                            <tr><td>slope increase</td><td>Increase longitudinal slope</td><td>Flow velocity below minimum, sedimentation risk</td></tr>
                            <tr><td>slope reduction</td><td>Decrease longitudinal slope</td><td>Flow velocity exceeding limits, erosion risk</td></tr>
                            <tr><td>depth increase</td><td>Increase pipe depth</td><td>Insufficient cover in frost zones</td></tr>
                            <tr><td>valid</td><td>No modifications required</td><td>All parameters within design range</td></tr>
                        </tbody>
                    </table>
                </div>

                <h5>3.2 Recommendation Model Architecture</h5>
                <p>The recommendation system employs a neural network with:</p>
                <ul>
                    <li><strong>Input normalization:</strong> Min-max scaling for continuous variables, one-hot encoding for categorical variables</li>
                    <li><strong>Architecture:</strong> 32-neuron first layer, 16-neuron second layer with batch normalization</li>
                    <li><strong>Regularization:</strong> L2 regularization (1×10⁻⁴) and dropout (0.15)</li>
                    <li><strong>Performance:</strong> 99.8% accuracy on test set, macro-F₁ = 0.995</li>
                </ul>

                <h5>3.3 Model Comparison Analysis</h5>
                <p>Comparative analysis against alternative algorithms demonstrated neural network superiority:</p>
                <div class="table-responsive scrollable-table-container">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Algorithm</th>
                                <th>Accuracy</th>
                                <th>Macro-F1</th>
                                <th>Training Time</th>
                                <th>Prediction Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Neural Network</td><td>99.93%</td><td>0.873</td><td>15s</td><td>0.053 ms/sample</td></tr>
                            <tr><td>Random Forest</td><td>99.79%</td><td>0.872</td><td>0.38s</td><td>0.039 ms/sample</td></tr>
                            <tr><td>XGBoost</td><td>99.93%</td><td>0.875</td><td>0.42s</td><td>0.007 ms/sample</td></tr>
                            <tr><td>SVM</td><td>98.32%</td><td>0.856</td><td>0.56s</td><td>0.093 ms/sample</td></tr>
                        </tbody>
                    </table>
                </div>

                <h4 id="data-integration">4. Data Integration & Feature Engineering</h4>
                <p>The system integrates multiple data sources through sophisticated feature engineering:</p>
                <ul>
                    <li><strong>Hydraulic validation results:</strong> Binary indicators for velocity, slope, depth, and filling compliance</li>
                    <li><strong>Geometric parameters:</strong> Pipe diameters, slopes, burial depths with normalization</li>
                    <li><strong>Catchment mapping:</strong> Subcatchment assignment to nodes using spatial analysis</li>
                    <li><strong>Environmental integration:</strong> Catchment categories propagated to pipe level</li>
                </ul>

                <h4 id="technical-framework">5. Technical Implementation Framework</h4>
                <p>The system leverages modern computational tools:</p>
                <ul>
                    <li><strong>SWMM Integration:</strong> Direct .inp file processing using PySWMM (v1.2.0) and swmmio (v0.6.7)</li>
                    <li><strong>Machine Learning:</strong> TensorFlow/Keras with Adam optimizer and categorical cross-entropy loss</li>
                    <li><strong>Data Processing:</strong> Pandas for data manipulation, NumPy for numerical operations</li>
                    <li><strong>Validation:</strong> Scikit-learn for cross-validation and performance metrics</li>
                </ul>

                <h3 id="applications">Applications & Standards Compliance</h3>
                <p>This comprehensive system supports various engineering applications while ensuring compliance with established standards:</p>
                <ul>
                    <li><strong>Design Applications:</strong> New storm sewer network design, existing infrastructure assessment, modernization planning</li>
                    <li><strong>Standards Compliance:</strong> PN-EN 752:2008, PN-81/B-03020, WPT guidelines, ATV A-118:2006</li>
                    <li><strong>Local Adaptation:</strong> Polish frost zone requirements, IMGW-PIB rainfall data, regional soil conditions</li>
                    <li><strong>Quality Assurance:</strong> Continuous validation against field measurements, iterative model improvement</li>
                </ul>

                <h3 id="future-development">Future Development & Research</h3>
                <p>The system continues evolving with ongoing research in:</p>
                <ul>
                    <li>Climate change impact assessment on rainfall patterns</li>
                    <li>Integration of real-time sensor data for dynamic model updating</li>
                    <li>Expansion to combined sewer systems and green infrastructure</li>
                    <li>Cost optimization algorithms for renovation planning</li>
                </ul>

                <h3 id="contact">Contact & Collaboration</h3>
                <p>For technical questions, collaboration opportunities, or access to research data, please contact our development team. The system represents ongoing collaboration between hydraulic engineering expertise and machine learning innovation in water management systems.</p>
            </div>
        </div>
    </div>

<style>
/* Professional Documentation Styles */
.container-fluid {
    padding-left: 0;
    padding-right: 0;
    padding-top: 20px;
    margin-left: 0;
    max-width: 100%;
    overflow-x: hidden;
}

.row {
    margin-left: 0;
    margin-right: 0;
}

.sidebar {
    background: linear-gradient(180deg, #f8f9fa 0%, #f1f3f4 100%);
    border-right: 2px solid #e9ecef;
    min-height: 100vh;
    padding: 0;
    box-shadow: 2px 0 10px rgba(0,0,0,0.05);
    padding-left: 0;
    margin-left: 0;
    position: fixed;
    left: 0;
    top: 0;
    width: 240px;
    z-index: 100;
}

.sidebar-sticky {
    position: relative;
    top: 120px;
    padding: 1rem 1rem 0 1rem;
}

.sidebar-heading {
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1.5rem;
    font-size: 1.15rem;
    border-bottom: 3px solid #007bff;
    padding-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.sidebar .nav-link {
    color: #495057;
    padding: 0.75rem 0;
    font-size: 0.95rem;
    font-weight: 500;
    border: none;
    border-radius: 6px;
    transition: all 0.3s ease;
    margin: 0.25rem 0;
}

.sidebar .nav-link:hover {
    color: #007bff;
    background-color: rgba(0, 123, 255, 0.08);
    text-decoration: none;
    padding-left: 0.75rem;
    transform: translateX(5px);
}

.sidebar .nav-link.active {
    color: #2c3e50;
    font-weight: 600;
    background: #D5E3F5;
    border-left: 4px solid #007bff;
    padding-left: 0.75rem;
    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
    border-radius: 6px;
}

.sidebar .nav-link-sub {
    font-size: 0.875rem;
    color: #6c757d;
    padding-left: 1.5rem;
    font-weight: 400;
    position: relative;
}

.sidebar .nav-link-sub:before {
    content: "▸";
    position: absolute;
    left: 1rem;
    color: #007bff;
    transition: all 0.2s ease;
}

.sidebar .nav-link-sub:hover {
    color: #007bff;
    padding-left: 2rem;
    background-color: rgba(0, 123, 255, 0.05);
}

.sidebar .nav-link-sub:hover:before {
    transform: rotate(90deg);
}

.sidebar .nav-link-sub.active {
    color: #2c3e50;
    font-weight: 600;
    background: #D5E3F5;
    border-left: 3px solid #007bff;
    padding-left: 2rem;
    border-radius: 4px;
}

.main-content {
    padding: 2.5rem 2rem;
    max-width: calc(100% - 240px);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.7;
    color: #2c3e50;
    margin-left: 240px;
    width: calc(100% - 240px);
    box-sizing: border-box;
}

.page-title {
    color: #1a252f;
    margin-bottom: 3rem;
    padding-bottom: 1.5rem;
    border-bottom: 4px solid #007bff;
    font-weight: 700;
    font-size: 2.5rem;
    background: linear-gradient(135deg, #2c3e50, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.main-content h3, .main-content h4 {
    scroll-margin-top: 120px;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
}

.main-content h3 {
    color: #2c3e50;
    font-weight: 700;
    font-size: 1.75rem;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 0.75rem;
    position: relative;
}

.main-content h3:before {
    content: "";
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.main-content h4 {
    color: #2c3e50;
    font-weight: 600;
    font-size: 1.4rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding: 0.75rem 0 0.75rem 1rem;
    border-left: 4px solid #007bff;
    background: linear-gradient(135deg, rgba(213, 227, 245, 0.3), rgba(213, 227, 245, 0.1));
    border-radius: 0 8px 8px 0;
    position: relative;
}

.main-content h5 {
    color: #2c3e50;
    font-weight: 600;
    font-size: 1.15rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
    padding: 0.6rem 0 0.6rem 1rem;
    border-left: 3px solid #007bff;
    background: linear-gradient(135deg, rgba(213, 227, 245, 0.2), rgba(213, 227, 245, 0.05));
    border-radius: 0 6px 6px 0;
}

.main-content p {
    margin-bottom: 1.25rem;
    font-size: 1rem;
    color: #4a5568;
    text-align: justify;
}

.main-content ul, .main-content ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
}

.main-content li {
    margin-bottom: 0.75rem;
    color: #4a5568;
    line-height: 1.6;
}

.main-content strong {
    color: #2c3e50;
    font-weight: 600;
}

.main-content .table-responsive {
    margin: 2.5rem 0;
    border-radius: 14px;
    overflow: auto;
    box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
    background: #ffffff;
    border: 2px solid #b8cde6;
    max-width: 100%;
    position: relative;
    cursor: grab;
}

.main-content .table-responsive.active-drag {
    cursor: grabbing;
    user-select: none;
}

.main-content .table-responsive.scrollable-table {
    border: 3px solid var(--grey-500, #6b7280);
}

.scroll-hint {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 123, 255, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    z-index: 10;
    animation: pulse 2s infinite;
    pointer-events: none;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Scrollbar styling for tables */
.main-content .table-responsive::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.main-content .table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.main-content .table-responsive::-webkit-scrollbar-thumb {
    background: var(--grey-500, #6b7280);
    border-radius: 4px;
}

.main-content .table-responsive::-webkit-scrollbar-thumb:hover {
    background: #4a5568;
}

.main-content .table {
    margin-bottom: 0;
    font-size: 0.9rem;
    border-collapse: separate;
    border-spacing: 0;
}

.main-content .table th {
    background: #D5E3F5;
    color: #2c3e50;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-size: 0.8rem;
    padding: 0.75rem 1rem;
    border: 2px solid #b8cde6;
    text-align: center;
    position: relative;
}

.main-content .table th:first-child {
    border-top-left-radius: 12px;
}

.main-content .table th:last-child {
    border-top-right-radius: 12px;
}

.main-content .table th::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, rgba(44,62,80,0.1), rgba(44,62,80,0.3), rgba(44,62,80,0.1));
}

.main-content .table td {
    padding: 0.65rem 1rem;
    vertical-align: middle;
    color: #4a5568;
    border: 1px solid #d1d5db;
    text-align: center;
    font-weight: 500;
    transition: all 0.3s ease;
}

.main-content .table td:first-child {
    text-align: left;
    font-weight: 600;
    color: #2c3e50;
    background: #f8fafc;
    border-left: 2px solid #b8cde6;
}

.main-content .table-striped tbody tr:nth-of-type(odd) {
    background: #f9fafb;
}

.main-content .table-striped tbody tr:nth-of-type(even) {
    background: #ffffff;
}

.main-content .table tbody tr:hover {
    background: #e1f5fe !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.15);
}

.main-content .table tbody tr:hover td {
    color: #2c3e50;
}

.main-content .table tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
}

.main-content .table tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
}

.main-content .table td:contains("Zone") {
    font-family: 'Monaco', 'Menlo', monospace;
    background-color: rgba(0, 123, 255, 0.05);
}

/* Numerical values styling */
.main-content .table td:nth-child(2),
.main-content .table td:nth-child(3) {
    font-family: 'Monaco', 'Menlo', monospace;
    font-weight: 600;
    color: #007bff;
}

/* Add subtle animation to tables on scroll */
.main-content .table-responsive {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Add loading animation delay for multiple tables */
.main-content .table-responsive:nth-of-type(1) { animation-delay: 0.1s; }
.main-content .table-responsive:nth-of-type(2) { animation-delay: 0.2s; }
.main-content .table-responsive:nth-of-type(3) { animation-delay: 0.3s; }
.main-content .table-responsive:nth-of-type(4) { animation-delay: 0.4s; }

/* Mobile responsiveness */
@media (max-width: 768px) {
    .container-fluid {
        padding-left: 0;
        padding-right: 0;
        max-width: 100%;
    }

    .sidebar {
        position: relative;
        min-height: auto;
        border-right: none;
        border-bottom: 2px solid #dee2e6;
        background: #f8f9fa;
        width: 100%;
        left: auto;
        top: auto;
        z-index: auto;
    }

    .sidebar-sticky {
        position: relative;
        top: auto;
        padding: 1rem;
    }

    .main-content {
        margin-left: 0;
        padding: 1.5rem 1rem;
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
    }

    .sidebar-heading {
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .main-content {
        padding: 1.5rem 1rem;
    }

    .page-title {
        font-size: 2rem;
        margin-bottom: 2rem;
    }

    .main-content h3 {
        font-size: 1.5rem;
        margin-top: 2rem;
    }

    .main-content h4 {
        font-size: 1.25rem;
        margin-top: 2rem;
    }

    .main-content h5 {
        font-size: 1.1rem;
    }

    .main-content p {
        text-align: left;
        font-size: 0.95rem;
    }

    .main-content .table-responsive {
        margin: 1.5rem 0;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
        overflow: auto;
        -webkit-overflow-scrolling: touch;
    }

    .scroll-hint {
        font-size: 0.7rem;
        padding: 3px 6px;
        bottom: 6px;
        right: 6px;
    }

    .main-content .table th {
        padding: 0.75rem 0.5rem;
        font-size: 0.75rem;
    }

    .main-content .table td {
        padding: 0.75rem 0.5rem;
        font-size: 0.85rem;
    }

    .main-content .table th:first-child,
    .main-content .table th:last-child {
        border-radius: 8px 8px 0 0;
    }
}

@media print {
    .sidebar {
        display: none;
    }

    .main-content {
        padding: 0;
        margin: 0;
    }

    .page-title {
        color: #000 !important;
        background: none !important;
        -webkit-text-fill-color: initial !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.sidebar a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const headerHeight = 120; // Adjust this value based on your header height
                const targetPosition = target.offsetTop - headerHeight;

                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Active section highlighting
    const sections = document.querySelectorAll('h3[id], h4[id]');
    const navLinks = document.querySelectorAll('.sidebar .nav-link');

    function updateActiveNavigation() {
        const scrollPos = window.pageYOffset + 250;
        let current = '';

        // Find the current section
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight + 100) {
                current = section.getAttribute('id');
            }
        });

        // If no section is found in the middle, find the closest one above
        if (!current) {
            let closestSection = null;
            let closestDistance = Infinity;

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const distance = Math.abs(scrollPos - sectionTop);

                if (scrollPos >= sectionTop - 200 && distance < closestDistance) {
                    closestDistance = distance;
                    closestSection = section;
                }
            });

            if (closestSection) {
                current = closestSection.getAttribute('id');
            }
        }

        // Remove all active classes
        navLinks.forEach(link => link.classList.remove('active'));

        // Add active class to corresponding nav link
        if (current) {
            const activeLink = document.querySelector(`.sidebar a[href="#${current}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }
    }

    // Throttle scroll events for better performance
    let ticking = false;

    function onScroll() {
        if (!ticking) {
            requestAnimationFrame(updateActiveNavigation);
            ticking = true;
            setTimeout(() => ticking = false, 100);
        }
    }

    // Update on scroll
    window.addEventListener('scroll', onScroll);

    // Initial update
    setTimeout(updateActiveNavigation, 100);

});
</script>

{% endblock %}
